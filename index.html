<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday, Bro!</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-color: #16213e;
            --primary-color: #0f3460;
            --accent-color: #3EC70B;
            --text-color: #dcdcdc;
            --title-color: #ffffff;
            --wish-card-bg: #2a2a4e;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 500px;
            width: 100%;
            text-align: center;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 1s ease-out forwards;
        }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        
        .birthday-card {
            background-color: var(--card-color);
            border-radius: 20px 20px 0 0;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 2px solid var(--primary-color);
            border-bottom: none;
            animation: slideUp 1.2s ease-out forwards;
        }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .card-header .profile-pic {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid var(--accent-color);
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }
        .profile-pic:hover { transform: scale(1.1) rotate(5deg); }
        .card-header h1 { font-size: 2.5rem; font-weight: 900; color: var(--title-color); margin-bottom: 5px; }
        .card-header h2 { font-size: 1.2rem; color: var(--accent-color); font-weight: 700; margin-bottom: 20px; }
        .card-body p { font-size: 1rem; line-height: 1.6; margin-bottom: 25px; }

        .form-and-wishes {
            background-color: var(--card-color);
            border-radius: 0 0 20px 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 2px solid var(--primary-color);
            border-top: 2px solid var(--primary-color);
            animation: slideUp 1.5s ease-out forwards;
        }
        
        .wishes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .wishes-header h3 { color: var(--title-color); font-size: 1.3rem; margin: 0; }
        .wishes-counter { background-color: var(--accent-color); color: var(--bg-color); padding: 5px 15px; border-radius: 20px; font-weight: 700; font-size: 0.9rem; }
        
        .wish-form input, .wish-form textarea {
            width: 100%;
            background-color: var(--bg-color);
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            padding: 12px;
            color: var(--text-color);
            font-family: 'Montserrat', sans-serif;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .wish-form textarea { resize: vertical; height: 80px; }

        .btn {
            display: inline-block; background-color: var(--accent-color); color: var(--bg-color); padding: 12px 25px; border-radius: 50px; text-decoration: none; font-weight: 700; border: none; cursor: pointer; transition: background-color 0.3s ease, transform 0.3s ease; margin: 5px; font-size: 1rem;
        }
        .btn:hover { background-color: #55D82C; transform: translateY(-3px); }
        .btn i { margin-right: 8px; }
        
        #wishes-container {
            margin-top: 25px;
            text-align: left;
            display: block; 
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .wish-card {
            background-color: var(--wish-card-bg); 
            border-radius: 10px; 
            padding: 15px; 
            border-left: 5px solid var(--accent-color); 
            opacity: 0; 
            animation: fadeInWish 0.5s ease-out forwards;
            width: 100%;
            margin-bottom: 15px;
        }

        @keyframes fadeInWish { to { opacity: 1; } }

        .wish-card strong { display: block; color: var(--title-color); margin-bottom: 5px; font-size: 1rem; }
        .wish-card p {
            font-size: 0.9rem;
            margin-bottom: 10px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .wish-card .timestamp { display: block; text-align: right; font-size: 0.75rem; color: #a0a0a0; font-style: italic; }
        .action-buttons { animation: slideUp 1.8s ease-out forwards; margin-top: 25px; }
        .copyright {
            margin-top: 30px;
            text-align: center;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            animation: slideUp 2s ease-out forwards;
        }
        .custom-alert-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7); display: none;
            justify-content: center; align-items: center; z-index: 1000;
            padding: 20px; opacity: 0; transition: opacity 0.3s ease;
        }
        .custom-alert-box {
            background-color: var(--card-color); padding: 30px; border-radius: 15px;
            border: 2px solid var(--primary-color); text-align: center;
            max-width: 320px; width: 100%; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transform: scale(0.9); transition: transform 0.3s ease;
        }
        .custom-alert-box p {
            font-size: 1.1rem; color: var(--text-color); margin: 0;
            margin-bottom: 20px; line-height: 1.6;
        }
        .custom-alert-box .btn { color: var(--title-color); }
        
        /* KODE BARU: CSS untuk Tombol Musik */
        #interaction-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        #playButton {
            font-size: 1.2rem;
            padding: 15px 35px;
        }
    </style>
</head>
<body>
    
    <audio id="backgroundMusic" src="Hbdqodry.mp3" loop></audio>

    <div id="interaction-overlay">
        <button id="playButton" class="btn">Kasih Ucapan hbd </button>
    </div>

    <div class="container" style="display: none;">
        
        <div id="full-card-to-save">
            <div class="birthday-card">
                <div class="card-header">
                    <img src="Qodry.jpg" alt="Foto Profil" class="profile-pic">
                    <h1>Nama Sahabatmu</h1>
                    <h2>Happy Level-Up Day! ðŸ¥³</h2>
                </div>
                <div class="card-body">
                    <p>Selamat ulang tahun, Bro! Semoga di umur yang baru ini lo makin sukses, sehat selalu, dan semua yang lo impikan bisa tercapai. Gue bangga punya sahabat kayak lo. Terima kasih udah jadi temen seperjuangan. Jangan lupa traktiran, ya! Haha. All the best for you! ðŸŽ‰</p>
                </div>
            </div>

            <div class="form-and-wishes">
                <div class="wishes-header">
                    <h3><i class="fas fa-comments"></i> Papan Ucapan</h3>
                    <div class="wishes-counter"><span id="wishCount">0</span> Ucapan</div>
                </div>
                
                <div class="wish-form" id="wish-form-area">
                    <input type="text" id="senderName" placeholder="Nama kamu (boleh kosong)...">
                    <textarea id="customMessage" placeholder="Tulis ucapan kerenmu di sini..."></textarea>
                    <button class="btn" onclick="submitWish()"><i class="fas fa-paper-plane"></i> Kirim Ucapan</button>
                </div>
                
                <div id="wishes-container"></div>
            </div>
        </div>

        <div class="action-buttons" id="action-buttons-area">
            <button class="btn" onclick="saveCard()"><i class="fas fa-download"></i> Simpan Kartu & Ucapan</button>
        </div>
        
        <footer class="copyright">
            <p>&copy; <span id="currentYear"></span>  Made By: Appwebiatecth & Studioofficial - All Right Reserved.</p>
        </footer>
        
    </div>

    <div class="custom-alert-overlay" id="customAlert">
        <div class="custom-alert-box">
            <p id="customAlertMessage">Ini adalah pesan default.</p>
            <button class="btn" onclick="hideCustomAlert()">OKE</button>
        </div>
    </div>

    <script>
        // KODE BARU UNTUK MEMUTAR MUSIK
        document.addEventListener('DOMContentLoaded', () => {
            const playButton = document.getElementById('playButton');
            const backgroundMusic = document.getElementById('backgroundMusic');
            const mainContainer = document.querySelector('.container');
            const overlay = document.getElementById('interaction-overlay');

            playButton.addEventListener('click', () => {
                backgroundMusic.play().catch(error => {
                    console.log("Autoplay dicegah oleh browser, tapi akan main setelah user klik.");
                });
                overlay.style.display = 'none';
                mainContainer.style.display = 'block';
            });
        });

        // Konfigurasi Firebase Anda
        const firebaseConfig = {
            apiKey: "AIzaSyBV84LBkoQMOfN9rF3nWNdL3KE26Si0Fhs",
            authDomain: "hbdqodrybar.firebaseapp.com",
            projectId: "hbdqodrybar",
            storageBucket: "hbdqodrybar.firebasestorage.app",
            messagingSenderId: "201990993595",
            appId: "1:201990993595:web:369214946776c2ab885b9e",
            measurementId: "G-MNWCC6ZR40"
        };
        firebase.initializeApp(firebaseConfig);

        // Menggunakan Firestore
        const db = firebase.firestore();
        const wishesRef = db.collection('wishes');

        const wishesContainer = document.getElementById('wishes-container');
        const wishCountSpan = document.getElementById('wishCount');
        const customAlert = document.getElementById('customAlert');
        const customAlertMessage = document.getElementById('customAlertMessage');

        function renderWish(name, message, timestamp) {
            const wishCard = document.createElement('div');
            wishCard.classList.add('wish-card');
            
            const cleanName = name.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            const cleanMessage = message.replace(/</g, "&lt;").replace(/>/g, "&gt;");

            wishCard.innerHTML = `<strong>Dari: ${cleanName}</strong><p>${cleanMessage}</p><div class="timestamp">${timestamp}</div>`;
            wishesContainer.appendChild(wishCard);
        }

        function submitWish() {
            let senderName = document.getElementById('senderName').value.trim();
            const message = document.getElementById('customMessage').value.trim();

            if (message === '') {
                showCustomAlert('Ucapan tidak boleh kosong ya!');
                return;
            }
            if (senderName === '') {
                senderName = 'Seseorang';
            }
            
            wishesRef.add({
                name: senderName,
                message: message,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                document.getElementById('senderName').value = '';
                document.getElementById('customMessage').value = '';
                const lastWishCard = wishesContainer.lastElementChild;
                if (lastWishCard) {
                    lastWishCard.scrollIntoView({ behavior: 'smooth', block: 'end' });
                }
            }).catch((error) => {
                console.error("Gagal mengirim ucapan: ", error);
                showCustomAlert('Gagal mengirim ucapan, coba lagi.');
            });
        }
        
        wishesRef.orderBy('timestamp', 'asc').onSnapshot((snapshot) => {
            wishesContainer.innerHTML = '';
            const totalWishes = snapshot.size;
            wishCountSpan.textContent = totalWishes;
            
            snapshot.forEach((doc) => {
                const wish = doc.data();
                let formattedTimestamp = 'Baru saja';
                
                if (wish.timestamp && wish.timestamp.toDate) {
                    const date = wish.timestamp.toDate();
                    formattedTimestamp = date.toLocaleDateString('id-ID', { day: '2-digit', month: 'long', year: 'numeric' }) + ' - ' + date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
                }
                
                renderWish(wish.name, wish.message, formattedTimestamp);
            });
        });

        function showCustomAlert(message) {
            customAlertMessage.textContent = message;
            customAlert.style.display = 'flex';
            setTimeout(() => {
                customAlert.style.opacity = '1';
                customAlert.querySelector('.custom-alert-box').style.transform = 'scale(1)';
            }, 10);
        }

        function hideCustomAlert() {
            customAlert.style.opacity = '0';
            customAlert.querySelector('.custom-alert-box').style.transform = 'scale(0.9)';
            setTimeout(() => {
                customAlert.style.display = 'none';
            }, 300);
        }

        function saveCard() {
            const captureTarget = document.getElementById('full-card-to-save');
            const formArea = document.getElementById('wish-form-area');
            const buttonsArea = document.getElementById('action-buttons-area');
            
            showCustomAlert('Sedang menyiapkan gambar, mohon tunggu...');
            formArea.style.display = 'none';
            buttonsArea.style.display = 'none';

            setTimeout(() => {
                html2canvas(captureTarget, {
                    backgroundColor: '#1a1a2e', 
                    useCORS: true,
                    scale: 3 
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'kartu-ucapan-sahabat.jpg';
                    link.href = canvas.toDataURL('image/jpeg', 1.0);
                    link.click();
                    
                    formArea.style.display = 'block';
                    buttonsArea.style.display = 'block';
                    hideCustomAlert();
                }).catch(err => {
                    console.error('Gagal menyimpan gambar:', err);
                    showCustomAlert('Maaf, terjadi kesalahan saat menyimpan gambar.');
                    formArea.style.display = 'block';
                    buttonsArea.style.display = 'block';
                });
            }, 500);
        }

        document.getElementById('currentYear').textContent = new Date().getFullYear();
    </script>

</body>
</html>
